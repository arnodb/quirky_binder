use quirky_binder::{
    filter::{
        function::{
            emit::function_emit,
            terminate::function_terminate,
        },
    },
};

{
  (
      function_emit(
        fields: [("hello", "String")],
        body: r#"
            use fallible_iterator::IteratorExt;
            let record = "world".to_string().into();
            Some(Ok(record)).into_iter().transpose_into_fallible()
"#,
      )
    - function_terminate(
        body: r#"
            let record = input.next()?.unwrap();
            assert_eq!(record.hello(), "world");
            assert!(input.next()?.is_none());
            Ok(())
"#,
      )
  )
}

{
  (
      function_emit(
        fields: [("hi", "String")],
        body: r#"
            use fallible_iterator::IteratorExt;
            let record = "there".to_string().into();
            Some(Ok(record)).into_iter().transpose_into_fallible()
"#,
      )
    - function_terminate(
        body: r#"
            let record = input.next()?.unwrap();
            assert_eq!(record.hi(), "there");
            assert!(input.next()?.is_none());
            Ok(())
"#,
      )
  )
}
